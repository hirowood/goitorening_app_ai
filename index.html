<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI語彙力トレーニングアプリ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const { createRoot } = ReactDOM;

        // SVGアイコンコンポーネント
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                home: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                ),
                book: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                ),
                chat: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                ),
                mic: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                    </svg>
                ),
                micOff: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <line x1="1" y1="1" x2="23" y2="23" strokeWidth="2"></line>
                        <path d="m9 9v3a3 3 0 0 0 5.12 2.12L9 9z" strokeWidth="2"></path>
                        <path d="M12 2a3 3 0 0 1 3 3v7M19 10v2a7 7 0 0 1-.11 1.23" strokeWidth="2"></path>
                        <line x1="12" y1="19" x2="12" y2="23" strokeWidth="2"></line>
                        <line x1="8" y1="23" x2="16" y2="23" strokeWidth="2"></line>
                    </svg>
                ),
                check: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                    </svg>
                ),
                refresh: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                ),
                star: (
                    <svg className={className} fill="currentColor" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                    </svg>
                ),
                volume: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <polygon points="11,5 6,9 2,9 2,15 6,15 11,19" strokeWidth="2"></polygon>
                        <path d="M19.07 4.93A10 10 0 0 1 19.07 19.07M15.54 8.46A5 5 0 0 1 15.54 15.54" strokeWidth="2"></path>
                    </svg>
                ),
                target: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" strokeWidth="2"></circle>
                        <circle cx="12" cy="12" r="6" strokeWidth="2"></circle>
                        <circle cx="12" cy="12" r="2" strokeWidth="2"></circle>
                    </svg>
                )
            };
            return icons[name] || null;
        };

        // メインアプリケーション
        const VocabularyApp = () => {
            const [currentView, setCurrentView] = useState('home');
            const [mode, setMode] = useState('text');
            const [questions, setQuestions] = useState([]);
            const [answers, setAnswers] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [showResults, setShowResults] = useState(false);
            const [loading, setLoading] = useState(false);
            
            // 音声機能関連
            const [isRecording, setIsRecording] = useState(false);
            const [transcript, setTranscript] = useState('');
            const [textInput, setTextInput] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [scores, setScores] = useState([]);
            
            const recognitionRef = useRef(null);

            // 音声認識の初期化
            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
                    const recognition = new SpeechRecognition();
                    
                    recognition.continuous = false;
                    recognition.interimResults = true;
                    recognition.lang = 'ja-JP';
                    
                    recognition.onresult = (event) => {
                        let finalTranscript = '';
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                        setTranscript(finalTranscript);
                    };
                    
                    recognition.onend = () => {
                        setIsRecording(false);
                    };
                    
                    recognition.onerror = (event) => {
                        console.error('音声認識エラー:', event.error);
                        setIsRecording(false);
                    };
                    
                    recognitionRef.current = recognition;
                }
            }, []);

            // 練習問題データ
            const textQuestions = [
                {
                    sentence: "この提案は実に______で、誰も思いつかなかった斬新なアイデアだ。",
                    answer: "独創的",
                    explanation: "他にはない、その人だけの新しい考えや作品を表す言葉",
                    alternatives: ["革新的", "画期的", "創造的"],
                    businessExample: "独創的なマーケティング戦略で売上が倍増しました",
                    dailyExample: "彼女の独創的なレシピはいつも驚かされる"
                },
                {
                    sentence: "経営陣の______な判断により、会社は危機を乗り越えることができた。",
                    answer: "的確",
                    explanation: "目標や要点をしっかりと捉えて、正確で適切なさま",
                    alternatives: ["適切", "正確", "妥当"],
                    businessExample: "的確な市場分析により投資判断ができました",
                    dailyExample: "医師の的確な診断のおかげで早期治療ができた"
                },
                {
                    sentence: "彼の発言は______を含んでおり、深く考えさせられるものだった。",
                    answer: "示唆",
                    explanation: "直接言わずに、それとなく相手に気づかせること",
                    alternatives: ["暗示", "含意", "意味"],
                    businessExample: "社長の示唆に富んだ講話から多くを学びました",
                    dailyExample: "彼の示唆的な発言に隠された意味を考えてみた"
                }
            ];

            const conversationQuestions = [
                {
                    situation: "会議で新しい企画について意見を求められた場面",
                    prompt: "この新しい企画についてどう思いますか？",
                    targetWord: "革新的",
                    modelAnswer: "とても革新的な企画だと思います。従来のアプローチとは異なる新しい視点が盛り込まれていて、市場に新たな価値を提供できそうですね。",
                    explanation: "従来にない新しさや変革をもたらす性質を表す"
                },
                {
                    situation: "同僚との会話で、最近読んだ本について話している場面",
                    prompt: "その本はどんな内容でしたか？",
                    targetWord: "示唆的",
                    modelAnswer: "非常に示唆的な内容でした。表面的な話だけでなく、現代社会の問題についても深く考えさせられる要素が多く含まれていて、読み応えがありました。",
                    explanation: "それとなく大切な事柄を暗に示すさま"
                },
                {
                    situation: "プロジェクトの振り返りで困難だった点を説明する場面",
                    prompt: "今回のプロジェクトで特に苦労した点はありますか？",
                    targetWord: "複雑",
                    modelAnswer: "要件が複雑で、複数の部署間での調整が必要だった点が特に大変でした。しかし、チーム一丸となって取り組んだ結果、良い成果を出すことができました。",
                    explanation: "いくつもの要素が絡み合って、理解や処理が難しいさま"
                }
            ];

            // 練習開始
            const startTraining = (selectedMode) => {
                setMode(selectedMode);
                const selectedQuestions = selectedMode === 'text' ? textQuestions : conversationQuestions;
                setQuestions(selectedQuestions);
                setAnswers(new Array(selectedQuestions.length).fill(''));
                setScores(new Array(selectedQuestions.length).fill(null));
                setCurrentQuestionIndex(0);
                setShowResults(false);
                setFeedback(null);
                setTranscript('');
                setTextInput('');
                setCurrentView('training');
            };

            // 音声録音開始/停止
            const toggleRecording = () => {
                if (isRecording) {
                    recognitionRef.current?.stop();
                } else {
                    if (recognitionRef.current) {
                        setTranscript('');
                        recognitionRef.current.start();
                        setIsRecording(true);
                    }
                }
            };

            // テキスト入力ハンドラー
            const handleTextChange = (index, value) => {
                const newAnswers = [...answers];
                newAnswers[index] = value;
                setAnswers(newAnswers);
            };

            const handleConversationTextChange = (e) => {
                const value = e.target.value;
                setTextInput(value);
                if (value) setTranscript('');
            };

            // 会話評価
            const evaluateConversation = async (response) => {
                setLoading(true);
                // 簡単な評価ロジック
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const question = questions[currentQuestionIndex];
                const targetWord = question.targetWord;
                const hasTargetWord = response.includes(targetWord);
                const length = response.length;
                
                let score = 3;
                let vocabularyUsage = 'fair';
                let naturalness = 'fair';
                let feedbackText = '';
                let improvements = [];
                let goodPoints = [];
                
                if (hasTargetWord) {
                    score++;
                    vocabularyUsage = 'good';
                    goodPoints.push(`「${targetWord}」を適切に使用できています`);
                } else {
                    improvements.push(`「${targetWord}」を使って回答してみましょう`);
                }
                
                if (length > 30 && !response.includes('えーっと')) {
                    score++;
                    naturalness = 'excellent';
                    goodPoints.push('自然で流暢な表現です');
                } else if (length < 10) {
                    improvements.push('もう少し詳しく表現してみましょう');
                }
                
                if (score >= 5) {
                    feedbackText = '素晴らしい回答です！語彙を適切に使い、自然な表現ができています。';
                    vocabularyUsage = 'excellent';
                } else if (score >= 4) {
                    feedbackText = 'とても良い回答です。少し改善するとさらに良くなります。';
                } else {
                    feedbackText = '基本的な回答はできています。語彙の使用と表現の自然さを意識してみましょう。';
                }
                
                const evaluation = {
                    score: Math.min(score, 5),
                    vocabularyUsage,
                    naturalness,
                    feedback: feedbackText,
                    improvements,
                    goodPoints
                };
                
                const newScores = [...scores];
                newScores[currentQuestionIndex] = evaluation;
                setScores(newScores);
                setFeedback(evaluation);
                setLoading(false);
            };

            // 回答提出
            const submitConversationAnswer = () => {
                const response = transcript || textInput;
                if (response.trim()) {
                    evaluateConversation(response.trim());
                }
            };

            // 次の問題
            const nextQuestion = () => {
                setFeedback(null);
                setTranscript('');
                setTextInput('');
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                } else {
                    setShowResults(true);
                }
            };

            // 結果表示
            const showAnswers = () => {
                setShowResults(true);
            };

            // ホームに戻る
            const goHome = () => {
                setCurrentView('home');
                setShowResults(false);
                setFeedback(null);
                setTranscript('');
                setTextInput('');
                setCurrentQuestionIndex(0);
                setAnswers([]);
                setQuestions([]);
                setScores([]);
            };

            // 音声合成
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    speechSynthesis.speak(utterance);
                }
            };

            // 外側クリックでフォーカス解除
            const handleOutsideClick = useCallback((e) => {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    document.activeElement?.blur();
                }
            }, []);

            useEffect(() => {
                document.addEventListener('click', handleOutsideClick);
                return () => document.removeEventListener('click', handleOutsideClick);
            }, [handleOutsideClick]);

            // ホーム画面
            const HomeView = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="text-center mb-12">
                            <h1 className="text-4xl font-bold text-gray-800 mb-4">
                                AI語彙力トレーニング
                            </h1>
                            <p className="text-xl text-gray-600 mb-8">
                                1日5分で会話力を向上させよう
                            </p>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8 mb-12">
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <div className="flex items-center mb-4">
                                    <Icon name="target" className="w-8 h-8 text-blue-600 mr-3" />
                                    <h3 className="text-xl font-semibold">学習効果</h3>
                                </div>
                                <ul className="space-y-2 text-gray-600">
                                    <li>• 仕事での説得力向上</li>
                                    <li>• 会話のテンポ改善</li>
                                    <li>• 文章の個性向上</li>
                                    <li>• アイデアの拡張</li>
                                </ul>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <div className="flex items-center mb-4">
                                    <Icon name="chat" className="w-8 h-8 text-green-600 mr-3" />
                                    <h3 className="text-xl font-semibold">新機能：会話練習</h3>
                                </div>
                                <ul className="space-y-2 text-gray-600">
                                    <li>• 音声入力対応</li>
                                    <li>• AI評価システム</li>
                                    <li>• 実践的シナリオ</li>
                                    <li>• 詳細フィードバック</li>
                                </ul>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-xl shadow-lg p-8 text-center">
                                <Icon name="book" className="w-16 h-16 text-blue-600 mx-auto mb-4" />
                                <h2 className="text-2xl font-semibold mb-4">テキスト練習</h2>
                                <p className="text-gray-600 mb-6">
                                    空欄補充形式で語彙力を鍛える
                                </p>
                                <button
                                    onClick={() => startTraining('text')}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors"
                                >
                                    テキスト練習を開始
                                </button>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-8 text-center">
                                <Icon name="chat" className="w-16 h-16 text-green-600 mx-auto mb-4" />
                                <h2 className="text-2xl font-semibold mb-4">会話練習</h2>
                                <p className="text-gray-600 mb-6">
                                    音声入力で実際の会話を練習
                                </p>
                                <button
                                    onClick={() => startTraining('conversation')}
                                    className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors"
                                >
                                    会話練習を開始
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // テキスト練習画面
            const TextTrainingView = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-semibold">テキスト練習</h2>
                                <button
                                    onClick={goHome}
                                    className="flex items-center gap-2 px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <Icon name="home" className="w-5 h-5" />
                                    ホーム
                                </button>
                            </div>

                            {!showResults ? (
                                <div className="space-y-8">
                                    {questions.map((question, index) => (
                                        <div key={index} className="border-b border-gray-200 pb-6">
                                            <div className="mb-4">
                                                <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                                    問題 {index + 1}
                                                </span>
                                            </div>
                                            <p className="text-lg mb-4 leading-relaxed">
                                                {question.sentence}
                                            </p>
                                            <input
                                                type="text"
                                                value={answers[index] || ''}
                                                onChange={(e) => handleTextChange(index, e.target.value)}
                                                placeholder="答えを入力してください"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                autoComplete="off"
                                            />
                                        </div>
                                    ))}

                                    <div className="text-center">
                                        <button
                                            onClick={showAnswers}
                                            className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center mx-auto gap-2"
                                        >
                                            <Icon name="check" className="w-5 h-5" />
                                            答え合わせ
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="space-y-8">
                                    <h3 className="text-xl font-semibold text-center mb-6">解答と解説</h3>
                                    
                                    {questions.map((question, index) => (
                                        <div key={index} className="bg-gray-50 rounded-lg p-6">
                                            <div className="mb-4">
                                                <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                                    問題 {index + 1}
                                                </span>
                                            </div>
                                            
                                            <p className="text-lg mb-4">{question.sentence}</p>
                                            
                                            <div className="grid md:grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <span className="font-semibold text-gray-700">あなたの答え: </span>
                                                    <span className={answers[index]?.toLowerCase() === question.answer.toLowerCase() 
                                                        ? "text-green-600 font-semibold" : "text-red-600"}>
                                                        {answers[index] || "未回答"}
                                                    </span>
                                                </div>
                                                <div>
                                                    <span className="font-semibold text-gray-700">正解: </span>
                                                    <span className="text-green-600 font-semibold">{question.answer}</span>
                                                </div>
                                            </div>

                                            <div className="space-y-3">
                                                <div>
                                                    <h4 className="font-semibold text-gray-700 mb-1">解説:</h4>
                                                    <p className="text-gray-600">{question.explanation}</p>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold text-gray-700 mb-1">ビジネス例:</h4>
                                                    <p className="text-gray-600">{question.businessExample}</p>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold text-gray-700 mb-1">日常例:</h4>
                                                    <p className="text-gray-600">{question.dailyExample}</p>
                                                </div>
                                                
                                                <div>
                                                    <h4 className="font-semibold text-gray-700 mb-1">類義語:</h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {question.alternatives?.map((alt, altIndex) => (
                                                            <span key={altIndex} className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                                                {alt}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}

                                    <div className="text-center space-y-4">
                                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                            <h4 className="font-semibold text-yellow-800 mb-2">💡 今日の課題</h4>
                                            <p className="text-yellow-700">
                                                学んだ語彙から1つ選んで、今日の会話や文章で実際に使ってみましょう！
                                            </p>
                                        </div>
                                        
                                        <button
                                            onClick={() => startTraining('text')}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold mr-4"
                                        >
                                            もう一度練習
                                        </button>
                                        <button
                                            onClick={goHome}
                                            className="bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold"
                                        >
                                            ホームに戻る
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // 会話練習画面
            const ConversationTrainingView = () => (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-semibold">会話練習</h2>
                                <button
                                    onClick={goHome}
                                    className="flex items-center gap-2 px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    <Icon name="home" className="w-5 h-5" />
                                    ホーム
                                </button>
                            </div>

                            {!showResults && !feedback && (
                                <div className="space-y-8">
                                    <div className="text-center">
                                        <span className="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium">
                                            問題 {currentQuestionIndex + 1} / {questions.length}
                                        </span>
                                    </div>

                                    <div className="bg-blue-50 rounded-lg p-6">
                                        <h3 className="font-semibold text-blue-800 mb-3">シチュエーション</h3>
                                        <p className="text-blue-700 mb-4">{questions[currentQuestionIndex]?.situation}</p>
                                        
                                        <div className="flex items-center gap-3 mb-4">
                                            <h4 className="font-semibold text-blue-800">使ってほしい語彙:</h4>
                                            <span className="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-semibold">
                                                {questions[currentQuestionIndex]?.targetWord}
                                            </span>
                                        </div>

                                        <div className="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                            <div className="flex items-center justify-between">
                                                <p className="text-lg font-medium">
                                                    💬 「{questions[currentQuestionIndex]?.prompt}」
                                                </p>
                                                <button
                                                    onClick={() => speak(questions[currentQuestionIndex]?.prompt)}
                                                    className="text-blue-600 hover:text-blue-800 p-2"
                                                    title="音声で読み上げ"
                                                >
                                                    <Icon name="volume" className="w-5 h-5" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        <h3 className="text-lg font-semibold">あなたの回答</h3>
                                        
                                        <div className="flex gap-4 items-center">
                                            <button
                                                onClick={toggleRecording}
                                                disabled={!recognitionRef.current}
                                                className={`flex items-center px-6 py-3 rounded-lg font-semibold transition-colors ${
                                                    isRecording 
                                                    ? 'bg-red-600 hover:bg-red-700 text-white' 
                                                    : 'bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400 disabled:cursor-not-allowed'
                                                }`}
                                            >
                                                <Icon name={isRecording ? "micOff" : "mic"} className="w-5 h-5 mr-2" />
                                                {isRecording ? '録音停止' : '音声入力'}
                                            </button>
                                            
                                            {!recognitionRef.current && (
                                                <span className="text-gray-500 text-sm">
                                                    ※お使いのブラウザは音声認識に対応していません
                                                </span>
                                            )}
                                        </div>

                                        <div className="space-y-3">
                                            <textarea
                                                value={transcript || textInput}
                                                onChange={handleConversationTextChange}
                                                placeholder="ここに回答を入力するか、音声入力ボタンを使って話してください"
                                                className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent min-h-[100px] resize-none"
                                                rows="4"
                                            />
                                            
                                            {isRecording && (
                                                <div className="flex items-center text-red-600">
                                                    <div className="w-3 h-3 bg-red-600 rounded-full animate-pulse mr-2"></div>
                                                    録音中...
                                                </div>
                                            )}
                                        </div>

                                        <div className="text-center">
                                            <button
                                                onClick={submitConversationAnswer}
                                                disabled={loading || (!transcript && !textInput.trim())}
                                                className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center mx-auto disabled:opacity-50 disabled:cursor-not-allowed gap-2"
                                            >
                                                {loading ? (
                                                    <>
                                                        <Icon name="refresh" className="w-5 h-5 animate-spin" />
                                                        評価中...
                                                    </>
                                                ) : (
                                                    <>
                                                        <Icon name="check" className="w-5 h-5" />
                                                        回答を評価
                                                    </>
                                                )}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {feedback && !showResults && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-semibold text-center">評価結果</h3>
                                    
                                    <div className="bg-gray-50 rounded-lg p-6">
                                        <div className="flex items-center justify-center mb-4">
                                            <div className="flex items-center space-x-1">
                                                {[1, 2, 3, 4, 5].map((star) => (
                                                    <Icon 
                                                        key={star}
                                                        name="star" 
                                                        className={`w-8 h-8 ${
                                                            star <= feedback.score 
                                                            ? 'text-yellow-400' 
                                                            : 'text-gray-300'
                                                        }`}
                                                    />
                                                ))}
                                            </div>
                                            <span className="ml-3 text-2xl font-bold text-gray-700">
                                                {feedback.score}/5
                                            </span>
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                                            <div className="text-center">
                                                <h4 className="font-semibold text-gray-700 mb-1">語彙使用</h4>
                                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                                    feedback.vocabularyUsage === 'excellent' ? 'bg-green-100 text-green-800' :
                                                    feedback.vocabularyUsage === 'good' ? 'bg-blue-100 text-blue-800' :
                                                    'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    {feedback.vocabularyUsage}
                                                </span>
                                            </div>
                                            <div className="text-center">
                                                <h4 className="font-semibold text-gray-700 mb-1">会話の自然さ</h4>
                                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                                    feedback.naturalness === 'excellent' ? 'bg-green-100 text-green-800' :
                                                    feedback.naturalness === 'good' ? 'bg-blue-100 text-blue-800' :
                                                    'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    {feedback.naturalness}
                                                </span>
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-semibold text-gray-700 mb-2">フィードバック</h4>
                                                <p className="text-gray-600">{feedback.feedback}</p>
                                            </div>

                                            {feedback.goodPoints && feedback.goodPoints.length > 0 && (
                                                <div>
                                                    <h4 className="font-semibold text-green-700 mb-2">👍 良い点</h4>
                                                    <ul className="list-disc list-inside space-y-1">
                                                        {feedback.goodPoints.map((point, index) => (
                                                            <li key={index} className="text-green-600">{point}</li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            )}

                                            {feedback.improvements && feedback.improvements.length > 0 && (
                                                <div>
                                                    <h4 className="font-semibold text-orange-700 mb-2">💡 改善点</h4>
                                                    <ul className="list-disc list-inside space-y-1">
                                                        {feedback.improvements.map((point, index) => (
                                                            <li key={index} className="text-orange-600">{point}</li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            )}

                                            <div>
                                                <h4 className="font-semibold text-gray-700 mb-2">📝 模範解答例</h4>
                                                <div className="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                                                    <p className="text-blue-700">{questions[currentQuestionIndex]?.modelAnswer}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="text-center">
                                        <button
                                            onClick={nextQuestion}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold"
                                        >
                                            {currentQuestionIndex < questions.length - 1 ? '次の問題へ' : '結果を見る'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {showResults && (
                                <div className="space-y-8">
                                    <h3 className="text-xl font-semibold text-center">会話練習結果</h3>
                                    
                                    <div className="text-center mb-6">
                                        <div className="text-3xl font-bold text-gray-700 mb-2">
                                            総合スコア: {scores.length > 0 ? (scores.reduce((sum, score) => sum + (score?.score || 0), 0) / scores.length).toFixed(1) : 0}/5
                                        </div>
                                        <div className="flex items-center justify-center">
                                            {[1, 2, 3, 4, 5].map((star) => (
                                                <Icon 
                                                    key={star}
                                                    name="star" 
                                                    className={`w-6 h-6 ${
                                                        star <= (scores.reduce((sum, score) => sum + (score?.score || 0), 0) / scores.length) 
                                                        ? 'text-yellow-400' 
                                                        : 'text-gray-300'
                                                    }`}
                                                />
                                            ))}
                                        </div>
                                    </div>

                                    {scores.map((score, index) => (
                                        score && (
                                            <div key={index} className="bg-gray-50 rounded-lg p-6">
                                                <div className="flex items-center justify-between mb-3">
                                                    <h4 className="font-semibold">問題 {index + 1}</h4>
                                                    <div className="flex items-center">
                                                        {[1, 2, 3, 4, 5].map((star) => (
                                                            <Icon 
                                                                key={star}
                                                                name="star" 
                                                                className={`w-5 h-5 ${
                                                                    star <= score.score 
                                                                    ? 'text-yellow-400' 
                                                                    : 'text-gray-300'
                                                                }`}
                                                            />
                                                        ))}
                                                    </div>
                                                </div>
                                                <p className="text-sm text-gray-600 mb-2">
                                                    語彙: {questions[index]?.targetWord}
                                                </p>
                                                <p className="text-gray-600">{score.feedback}</p>
                                            </div>
                                        )
                                    ))}

                                    <div className="text-center space-y-4">
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <h4 className="font-semibold text-green-800 mb-2">🎉 お疲れさまでした！</h4>
                                            <p className="text-green-700">
                                                継続的な練習で、会話力をさらに向上させましょう。毎日少しずつでも続けることが大切です。
                                            </p>
                                        </div>
                                        
                                        <button
                                            onClick={() => startTraining('conversation')}
                                            className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold mr-4"
                                        >
                                            もう一度練習
                                        </button>
                                        <button
                                            onClick={goHome}
                                            className="bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold"
                                        >
                                            ホームに戻る
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // 画面の表示制御
            const renderView = () => {
                if (currentView === 'home') {
                    return <HomeView />;
                } else if (mode === 'text') {
                    return <TextTrainingView />;
                } else {
                    return <ConversationTrainingView />;
                }
            };

            return renderView();
        };

        // アプリケーションをレンダリング
        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<VocabularyApp />);
    </script>
</body>
</html>